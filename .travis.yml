language: csharp
os: linux # Ubuntu 14.04
dist: trusty
sudo: required
dotnet: 1.0.0-preview2-003121
services:
  - docker
env:
  DOCKER_COMPOSE_VERSION: 1.4.2

before_install:
  # Run unit tests
  - dotnet restore
script:
  - cd ./Crunch.Tests
  - dotnet build
  - dotnet test
  # Launch application and tests
  - cd ../
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run test ./wait-for-it.sh web:5000 -- dotnet test

  # When we need to push up the docker container
  after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker tag crunch_web:lastest hartmannr76/crunch-api
    docker push hartmannr76/hartmannr76/crunch-api;
    fi
